<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS S3 Direct Test - No Proxy</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            margin: 0 0 20px 0;
            color: #333;
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        model-viewer {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            background: #f0f0f0;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß AWS S3 Direct Access Test</h1>

        <div class="status info">
            <strong>Purpose:</strong> Testing direct S3 access without proxy
        </div>

        <div class="test-section">
            <h2>Test 1: Direct S3 URL</h2>
            <p>URL: <code>https://newfurniture-ar-assets.s3.amazonaws.com/furniture-models/Groove_grey-scaled%20(1).glb</code></p>

            <button class="btn" onclick="testDirectS3()">Test Direct S3 Access</button>
            <div id="s3-result"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: Model Viewer with S3</h2>
            <model-viewer
                id="viewer"
                alt="Groove Grey Chair"
                camera-controls
                ar
                ar-modes="webxr scene-viewer quick-look">
                <button slot="ar-button" style="background: white; border-radius: 4px; border: none; position: absolute; top: 16px; right: 16px;">
                    View in AR
                </button>
            </model-viewer>

            <button class="btn" onclick="loadModel()">Load Model from S3</button>
            <button class="btn" onclick="loadModelWithCORS()">Load with CORS Headers</button>
            <div id="viewer-result"></div>
        </div>

        <div class="test-section">
            <h2>Test 3: Fetch Test</h2>
            <button class="btn" onclick="testFetch()">Test Fetch API</button>
            <div id="fetch-result"></div>
        </div>
    </div>

    <script>
        const S3_URL = 'https://newfurniture-ar-assets.s3.amazonaws.com/furniture-models/Groove_grey-scaled%20(1).glb';
        const S3_URL_WITH_REGION = 'https://newfurniture-ar-assets.s3.us-east-1.amazonaws.com/furniture-models/Groove_grey-scaled%20(1).glb';

        function updateResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.innerHTML = message;
        }

        async function testDirectS3() {
            updateResult('s3-result', 'Testing S3 access...', 'info');

            try {
                // Try without region
                const response1 = await fetch(S3_URL, { method: 'HEAD' });
                if (response1.ok) {
                    updateResult('s3-result',
                        `‚úÖ S3 Access Success (no region)!<br>
                         Status: ${response1.status}<br>
                         Content-Type: ${response1.headers.get('content-type')}<br>
                         Size: ${response1.headers.get('content-length')} bytes`,
                        'success');
                    return;
                }
            } catch (error) {
                console.error('S3 without region failed:', error);
            }

            try {
                // Try with region
                const response2 = await fetch(S3_URL_WITH_REGION, { method: 'HEAD' });
                if (response2.ok) {
                    updateResult('s3-result',
                        `‚úÖ S3 Access Success (with region)!<br>
                         Status: ${response2.status}<br>
                         Content-Type: ${response2.headers.get('content-type')}<br>
                         Size: ${response2.headers.get('content-length')} bytes`,
                        'success');
                } else {
                    updateResult('s3-result',
                        `‚ùå S3 Access Failed<br>
                         Status: ${response2.status}<br>
                         ${response2.statusText}`,
                        'error');
                }
            } catch (error) {
                updateResult('s3-result',
                    `‚ùå Network Error<br>
                     ${error.message}<br>
                     <small>This might be a CORS issue</small>`,
                    'error');
            }
        }

        function loadModel() {
            updateResult('viewer-result', 'Loading model from S3...', 'info');

            const viewer = document.getElementById('viewer');
            viewer.src = S3_URL;

            viewer.addEventListener('load', () => {
                updateResult('viewer-result', '‚úÖ Model loaded successfully!', 'success');
            });

            viewer.addEventListener('error', (event) => {
                updateResult('viewer-result',
                    `‚ùå Model load failed<br>
                     ${event.detail?.message || 'Unknown error'}`,
                    'error');
            });
        }

        function loadModelWithCORS() {
            updateResult('viewer-result', 'Trying with different S3 URL...', 'info');

            const viewer = document.getElementById('viewer');
            viewer.src = S3_URL_WITH_REGION;

            viewer.addEventListener('load', () => {
                updateResult('viewer-result', '‚úÖ Model loaded with region URL!', 'success');
            });

            viewer.addEventListener('error', (event) => {
                updateResult('viewer-result',
                    `‚ùå Region URL also failed<br>
                     ${event.detail?.message || 'CORS likely blocking'}`,
                    'error');
            });
        }

        async function testFetch() {
            updateResult('fetch-result', 'Testing fetch API...', 'info');

            try {
                const response = await fetch(S3_URL);
                const blob = await response.blob();

                updateResult('fetch-result',
                    `‚úÖ Fetch successful!<br>
                     Size: ${blob.size} bytes<br>
                     Type: ${blob.type}`,
                    'success');
            } catch (error) {
                updateResult('fetch-result',
                    `‚ùå Fetch failed<br>
                     ${error.message}<br>
                     <strong>CORS is blocking the request</strong>`,
                    'error');
            }
        }
    </script>
</body>
</html>