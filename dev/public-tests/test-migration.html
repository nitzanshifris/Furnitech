<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROCKER Migration Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .button { background: #0070f3; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 0; }
        .button:hover { background: #0051a0; }
        .result { background: #f5f5f5; padding: 20px; border-radius: 5px; margin: 20px 0; white-space: pre-wrap; font-family: monospace; }
        .success { border-left: 4px solid #00a000; }
        .error { border-left: 4px solid #e00; }
        .loading { color: #666; }
    </style>
</head>
<body>
    <h1>ğŸª‘ ROCKER Migration Test</h1>

    <p><strong>Goal:</strong> Migrate "×›×™×¡× × ×“× ×“×” ROCKER" from Cloudinary to AWS S3</p>

    <button class="button" onclick="runMigration()">ğŸš€ Run ROCKER Migration</button>

    <div id="result" class="result" style="display:none;">
        <div id="status" class="loading">Starting migration...</div>
        <div id="details"></div>
    </div>

    <script>
        async function runMigration() {
            const resultDiv = document.getElementById('result');
            const statusDiv = document.getElementById('status');
            const detailsDiv = document.getElementById('details');

            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            statusDiv.textContent = 'Starting ROCKER migration...';
            detailsDiv.textContent = '';

            try {
                const response = await fetch('/api/migrate-rocker', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'result success';
                    statusDiv.textContent = 'âœ… ROCKER Migration Successful!';

                    const details = `
Model: ${data.migration.model.title} (ID: ${data.migration.model.id})

ğŸ“¥ Cloudinary Source:
â€¢ URL: ${data.migration.cloudinary.url}
â€¢ Downloaded: ${(data.migration.cloudinary.downloadedSize / 1024 / 1024).toFixed(2)} MB

ğŸ“¤ AWS S3 Upload:
â€¢ URL: ${data.migration.aws.url}
â€¢ Bucket: ${data.migration.aws.bucket}
â€¢ Key: ${data.migration.aws.key}
â€¢ Size: ${(data.migration.aws.uploadedSize / 1024 / 1024).toFixed(2)} MB
â€¢ ETag: ${data.migration.aws.etag}

ğŸ” Verification: ${data.migration.verification.integrity}

ğŸ§ª Test URLs:
â€¢ AR Viewer: ${data.testUrls.arViewer}
â€¢ Direct AWS: ${data.testUrls.directAws}
â€¢ Original Cloudinary: ${data.testUrls.originalCloudinary}

Next Steps:
${data.nextSteps.map(step => 'â€¢ ' + step).join('\n')}
                    `;
                    detailsDiv.textContent = details;

                    // Add test links
                    const linksDiv = document.createElement('div');
                    linksDiv.innerHTML = `
                        <h3>ğŸ”— Quick Test Links:</h3>
                        <a href="${data.testUrls.arViewer}" target="_blank" style="display:block; margin:5px 0; color:#0070f3;">ğŸ¯ Test AR Viewer</a>
                        <a href="${data.testUrls.directAws}" target="_blank" style="display:block; margin:5px 0; color:#0070f3;">ğŸ“¦ Download AWS File</a>
                        <a href="${data.testUrls.originalCloudinary}" target="_blank" style="display:block; margin:5px 0; color:#0070f3;">â˜ï¸ Original Cloudinary</a>
                    `;
                    detailsDiv.appendChild(linksDiv);

                } else {
                    resultDiv.className = 'result error';
                    statusDiv.textContent = 'âŒ Migration Failed';
                    detailsDiv.textContent = `Error: ${data.error}\n\n${data.help || ''}`;
                }

            } catch (error) {
                resultDiv.className = 'result error';
                statusDiv.textContent = 'âŒ Network Error';
                detailsDiv.textContent = `Failed to connect to migration endpoint:\n${error.message}`;
            }
        }
    </script>
</body>
</html>